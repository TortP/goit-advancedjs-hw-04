{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_KEY = '20370935-71350e4ff636eebefea7dcc17';\nconst BASE_URL = 'https://pixabay.com/api/';\n\nexport const fetchImages = async (query, page = 1, perPage = 15) => {\n  const response = await axios.get(BASE_URL, {\n    params: {\n      key: API_KEY,\n      q: query,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page,\n      per_page: perPage,\n    },\n  });\n\n  return {\n    hits: response.data.hits,\n    totalHits: response.data.totalHits,\n  };\n};\n","export function createGalleryMarkup(images) {\n  return images\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n        <li class=\"gallery-item\" href=\"${largeImageURL}\">\n          <div class=\"image-wrapper\">\n            <img src=\"${webformatURL}\" alt=\"${tags}\" />\n          </div>\n          <div class=\"info\">\n            <p>Likes<br><strong>${likes}</strong></p>\n            <p>Views<br><strong>${views}</strong></p>\n            <p>Comments<br><strong>${comments}</strong></p>\n            <p>Downloads<br><strong>${downloads}</strong></p>\n          </div>\n        </li>\n      `\n    )\n    .join('');\n}\n","import './css/styles.css';\nimport '@fortawesome/fontawesome-free/css/all.min.css';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { fetchImages } from './js/pixabay-api';\nimport { createGalleryMarkup } from './js/render-functions';\n\nconst form = document.querySelector('.form');\nconst gallery = document.querySelector('.gallery');\nconst loader = document.querySelector('.loader');\nconst loadMoreBtn = document.querySelector('.load-more');\n\nlet lightbox = new SimpleLightbox('.gallery li');\n\nlet currentPage = 1;\nconst perPage = 15;\nlet currentQuery = '';\nlet shownImageIds = new Set();\nlet totalImages = 0;\nconst errorCatch = () =>\n  showToast(\n    'error',\n    'Something went wrong. Please try again later!',\n    '#ff4d4d',\n    'fa fa-times-circle'\n  );\nconst loadComplete = () =>\n  showToast(\n    'info',\n    \"We're sorry, but you've reached the end of search results.\",\n    '#106BDA',\n    'fas fa-info-circle'\n  );\n\nfunction showToast(type, message, backgroundColor, icon) {\n  const options = {\n    message,\n    position: 'topRight',\n    timeout: 3000,\n    backgroundColor,\n    titleColor: '#fff',\n    messageColor: '#fff',\n    icon,\n    iconColor: '#fff',\n    progressBarColor: '#fff',\n    close: true,\n    closeOnClick: true,\n  };\n  iziToast[type](options);\n}\n\nform.addEventListener('submit', async e => {\n  e.preventDefault();\n\n  currentQuery = form.elements.searchQuery.value.trim();\n  form.reset();\n  if (!currentQuery) {\n    showToast(\n      'warning',\n      'Enter a keyword to search!',\n      '#ffc107',\n      'fa fa-exclamation-circle'\n    );\n    return;\n  }\n\n  currentPage = 1;\n  gallery.innerHTML = '';\n  shownImageIds.clear();\n  loadMoreBtn.classList.add('is-hidden');\n  loader.classList.add('is-hidden');\n\n  loader.classList.remove('is-hidden');\n\n  try {\n    const { hits, totalHits } = await fetchImages(\n      currentQuery,\n      currentPage,\n      perPage\n    );\n    totalImages = totalHits;\n\n    const newImages = hits.filter(img => !shownImageIds.has(img.id));\n    newImages.forEach(img => shownImageIds.add(img.id));\n\n    if (newImages.length === 0) {\n      showToast(\n        'error',\n        'Sorry, there are no images matching your search query. Please, try again!',\n        '#ff4d4d',\n        'fa fa-times-circle'\n      );\n    } else {\n      const markup = createGalleryMarkup(newImages);\n      gallery.insertAdjacentHTML('beforeend', markup);\n      lightbox.refresh();\n\n      if (shownImageIds.size < totalImages) {\n        loadMoreBtn.classList.remove('is-hidden');\n      } else {\n        loadComplete();\n      }\n    }\n  } catch (error) {\n    errorCatch();\n  } finally {\n    loader.classList.add('is-hidden');\n  }\n});\n\nloadMoreBtn.addEventListener('click', async () => {\n  loader.classList.remove('is-hidden');\n  loadMoreBtn.classList.add('is-hidden');\n\n  let newImages = [];\n  let tempPage = currentPage + 1;\n\n  try {\n    while (newImages.length < perPage) {\n      const { hits } = await fetchImages(currentQuery, tempPage, perPage);\n      const uniqueHits = hits.filter(img => !shownImageIds.has(img.id));\n\n      if (uniqueHits.length === 0) {\n        break;\n      }\n\n      uniqueHits.forEach(img => shownImageIds.add(img.id));\n      newImages.push(...uniqueHits);\n      tempPage += 1;\n\n      if (shownImageIds.size >= totalImages) {\n        break;\n      }\n    }\n\n    currentPage = tempPage - 1;\n\n    if (newImages.length > 0) {\n      const markup = createGalleryMarkup(newImages.slice(0, perPage));\n      gallery.insertAdjacentHTML('beforeend', markup);\n      lightbox.refresh();\n\n      const card = document.querySelector('.gallery li');\n      if (card) {\n        const cardHeight = card.getBoundingClientRect().height;\n        window.scrollBy({\n          top: cardHeight * 3 + 20,\n          behavior: 'smooth',\n        });\n      }\n    }\n\n    if (shownImageIds.size >= totalImages || newImages.length < perPage) {\n      loadMoreBtn.classList.add('is-hidden');\n      loader.classList.add('is-hidden');\n      loadComplete();\n    } else {\n      loadMoreBtn.classList.remove('is-hidden');\n      loader.classList.add('is-hidden');\n    }\n  } catch (error) {\n    errorCatch();\n  } finally {\n    loader.classList.add('is-hidden');\n  }\n});\n"],"names":["API_KEY","BASE_URL","fetchImages","query","page","perPage","response","axios","createGalleryMarkup","images","webformatURL","largeImageURL","tags","likes","views","comments","downloads","form","gallery","loader","loadMoreBtn","lightbox","SimpleLightbox","currentPage","currentQuery","shownImageIds","totalImages","errorCatch","showToast","loadComplete","type","message","backgroundColor","icon","options","iziToast","e","hits","totalHits","newImages","img","markup","tempPage","uniqueHits","card","cardHeight"],"mappings":"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"}